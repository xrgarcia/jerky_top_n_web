2025-11-13T18:45:14Z info: Deployment: 794a255e-dd6a-42db-9f07-2778231e343a
2025-11-13T18:45:14Z info: Build: d91141a3-cbb3-4408-9542-16bf694b6f36
2025-11-13T18:45:14Z info: Connecting to builder
2025-11-13T18:45:14Z info: Builder connected
2025-11-13T18:45:15Z info: Installing packages
--> npm install


up to date, audited 422 packages in 6s

47 packages are looking for funding

  run `npm fund` for details


4 moderate severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

npm notice
npm notice New major version of npm available! 10.8.2 -> 11.6.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
npm notice To update run: npm install -g npm@11.6.2
npm notice

2025-11-13T18:45:22Z info: Starting Build

up to date, audited 422 packages in 937ms

47 packages are looking for funding
  run `npm fund` for details


4 moderate severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.


> jerky-top-n-web@1.0.0 db:migrate
> node server/migrations/migrate.js


[dotenv@17.2.2] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

ğŸ”„ Starting database migrations...

â–¶ï¸  Executing migration: 001_add_performance_indexes

âœ… Completed: 001_add_performance_indexes

â–¶ï¸  Executing migration: 002_add_shopify_created_at

âœ… Completed: 002_add_shopify_created_at
â–¶ï¸  Executing migration: 003_add_leaderboard_composite_indexes

âœ… Completed: 003_add_leaderboard_composite_indexes

â–¶ï¸  Executing migration: 004_create_engagement_scores_rollup

âœ… Completed: 004_create_engagement_scores_rollup
â–¶ï¸  Executing migration: 005_seed_classification_config

âœ… Completed: 005_seed_classification_config

â–¶ï¸  Executing migration: add-performance-indexes

âœ… Completed: add-performance-indexes


âœ… Successfully executed 6 migration(s)


> jerky-top-n-web@1.0.0 build
> npm run build:legacy && npm run build:react



> jerky-top-n-web@1.0.0 build:legacy
> node scripts/build-legacy-icon-bridge.js


âœ“ Legacy icon bridge built successfully


> jerky-top-n-web@1.0.0 build:react
> vite build


vite v7.1.12 building for production...

transforming...

âœ“ 1698 modules transformed.

rendering chunks...

[plugin vite:reporter] 
(!) /home/runner/workspace/src/utils/PersistentQueue.js is dynamically imported by /home/runner/workspace/src/pages/RankPage.jsx but also statically imported by /home/runner/workspace/src/hooks/useRanking.js, dynamic import will not move module into another chunk.


computing gzip size...

../public/dist/index.html                                       0.91 kB â”‚ gzip:   0.41 kB
../public/dist/assets/DataPage-BvdbPtu2.css                     2.20 kB â”‚ gzip:   0.87 kB

../public/dist/assets/ToolsLayout-Bzt7azfW.css                  2.34 kB â”‚ gzip:   0.79 kB

../public/dist/assets/FlavorProfilePage-C-ZOWa1a.css            2.92 kB â”‚ gzip:   0.97 kB

../public/dist/assets/CoinProfilePage-BztTGHIY.css              3.16 kB â”‚ gzip:   1.14 kB

../public/dist/assets/ProductDetailPage-BHAZry0Y.css            3.20 kB â”‚ gzip:   0.99 kB

../public/dist/assets/CoinTypesPageAdmin-RN88quPg.css           5.30 kB â”‚ gzip:   1.48 kB

../public/dist/assets/ProductsPage-DvaKpeYf.css                 5.38 kB â”‚ gzip:   1.50 kB
../public/dist/assets/QueueMonitorPage-C6juRa2H.css             5.53 kB â”‚ gzip:   1.58 kB

../public/dist/assets/PodiumWidget-Cg1Z7BA5.css                 6.85 kB â”‚ gzip:   1.84 kB
../public/dist/assets/UserGuidanceTab-BOhEnl-y.css              8.46 kB â”‚ gzip:   2.10 kB
../public/dist/assets/CoinBookPage-B0Lt4XRb.css                 8.55 kB â”‚ gzip:   2.21 kB

../public/dist/assets/LeaderboardPage-xuMChCzc.css              8.74 kB â”‚ gzip:   1.95 kB

../public/dist/assets/ManageCoinsPageAdmin-CzSW356y.css         8.93 kB â”‚ gzip:   2.34 kB

../public/dist/assets/BulkImportPage-1erujqXZ.css              10.02 kB â”‚ gzip:   2.38 kB

../public/dist/assets/CoinBookWidget-Cyu1dAkr.css              10.49 kB â”‚ gzip:   2.39 kB

../public/dist/assets/ProfilePage-DNH25kUa.css                 10.60 kB â”‚ gzip:   2.50 kB

../public/dist/assets/index-EzYXF57F.css                       13.97 kB â”‚ gzip:   3.55 kB

../public/dist/assets/CommunityPage-DnBJIYRz.css               15.26 kB â”‚ gzip:   3.57 kB

../public/dist/assets/RankPage-B9VFNn1Z.css                    17.45 kB â”‚ gzip:   4.05 kB

../public/dist/assets/PublicProfilePage-DZBFYyer.css           24.56 kB â”‚ gzip:   5.02 kB

../public/dist/assets/HomePage-DT1IVu2v.css                    25.72 kB â”‚ gzip:   5.18 kB

../public/dist/assets/AdminPages-DZ3DiwEz.css                  27.45 kB â”‚ gzip:   5.17 kB

../public/dist/assets/tierEmojis-RCWFwJCx.js                    0.10 kB â”‚ gzip:   0.11 kB

../public/dist/assets/usePageView-BRcW8nX9.js                   0.32 kB â”‚ gzip:   0.27 kB

../public/dist/assets/useGamification-Cv2LU1dF.js               0.35 kB â”‚ gzip:   0.22 kB
../public/dist/assets/useAdminAccess-BdRy8xWh.js                0.38 kB â”‚ gzip:   0.29 kB
../public/dist/assets/useProducts-DZ1yECVs.js                   0.64 kB â”‚ gzip:   0.38 kB

../public/dist/assets/api-C947NNjV.js                           1.15 kB â”‚ gzip:   0.55 kB

../public/dist/assets/PodiumWidget-Ds4tCyTh.js                  4.02 kB â”‚ gzip:   1.09 kB

../public/dist/assets/ToolsLayout-O6R8qJl4.js                   4.50 kB â”‚ gzip:   1.07 kB
../public/dist/assets/useAdminTools-D-8G3Jyb.js                 5.85 kB â”‚ gzip:   1.56 kB

../public/dist/assets/ProductsPage-CRG6MPTS.js                  6.58 kB â”‚ gzip:   1.46 kB
../public/dist/assets/LoginPage-DLMp9Kcm.js                     6.70 kB â”‚ gzip:   2.03 kB
../public/dist/assets/LiveUsersPage-CiMcw0JM.js                 7.35 kB â”‚ gzip:   1.55 kB

../public/dist/assets/en-US-DzAkKII6.js                         7.64 kB â”‚ gzip:   2.69 kB
../public/dist/assets/CoinProfilePage-Dh-eDvXt.js               7.88 kB â”‚ gzip:   1.58 kB

../public/dist/assets/FlavorProfilePage-uOm874j_.js             9.73 kB â”‚ gzip:   2.00 kB
../public/dist/assets/ProductDetailPage-DszoAWZ3.js            10.15 kB â”‚ gzip:   1.51 kB

../public/dist/assets/SentryPage-QbOtNoHp.js                   11.80 kB â”‚ gzip:   2.05 kB
../public/dist/assets/CoinTypesPageAdmin-BA_EWHOA.js           11.88 kB â”‚ gzip:   1.95 kB

../public/dist/assets/CoinBookWidget-n7JLVe3-.js               14.92 kB â”‚ gzip:   3.14 kB
../public/dist/assets/LeaderboardPage-D_THKECi.js              15.27 kB â”‚ gzip:   2.18 kB
../public/dist/assets/QueueMonitorPage-Cvpuu7hD.js             15.94 kB â”‚ gzip:   2.69 kB
../public/dist/assets/SentryIssueDetailsPage-BNgTBX_6.js       18.47 kB â”‚ gzip:   3.37 kB
../public/dist/assets/OrderItemsPage-DtK1gnYm.js               18.63 kB â”‚ gzip:   3.55 kB
../public/dist/assets/CustomerWebhooksPage-Bv1-GviQ.js         19.09 kB â”‚ gzip:   3.27 kB
../public/dist/assets/ProductWebhooksPage-mJbnf9Gm.js          20.78 kB â”‚ gzip:   3.69 kB

../public/dist/assets/CoinBookPage-BgwbqdQb.js                 22.76 kB â”‚ gzip:   3.26 kB

../public/dist/assets/ProductsPageAdmin-AI7OjRs9.js            23.86 kB â”‚ gzip:   3.45 kB

../public/dist/assets/FlavorCommunitiesPageAdmin-x4o2QKCf.js   32.05 kB â”‚ gzip:   4.91 kB

../public/dist/assets/HomePage-C1nRtXlc.js                     35.71 kB â”‚ gzip:   5.07 kB

../public/dist/assets/DataPage-Cb7z3WTN.js                     38.97 kB â”‚ gzip:   5.96 kB

../public/dist/assets/UserGuidanceTab-DgX6tlrp.js              39.28 kB â”‚ gzip:   5.09 kB
../public/dist/assets/ProfilePage-BDfFkjcd.js                  40.37 kB â”‚ gzip:  11.23 kB

../public/dist/assets/CommunityPage-CNV-zDHf.js                40.86 kB â”‚ gzip:   6.58 kB

../public/dist/assets/vendor-socket-CA1CrNgP.js                41.28 kB â”‚ gzip:  12.91 kB

../public/dist/assets/vendor-react-query-Dq4iOwXr.js           42.21 kB â”‚ gzip:  13.29 kB
../public/dist/assets/RankPage-Dza5OcMl.js                     42.89 kB â”‚ gzip:  10.86 kB

../public/dist/assets/BulkImportPage-Cmug92-c.js               43.81 kB â”‚ gzip:   6.11 kB

../public/dist/assets/PublicProfilePage-CUzn9wc_.js            51.88 kB â”‚ gzip:   9.97 kB

../public/dist/assets/ManageCoinsPageAdmin-CW2NMwBY.js         69.81 kB â”‚ gzip:  10.42 kB
../public/dist/assets/vendor-dnd-H3Ac9Kaa.js                   74.23 kB â”‚ gzip:  24.08 kB

../public/dist/assets/vendor-router-Dd1o6z0q.js                84.04 kB â”‚ gzip:  28.61 kB

../public/dist/assets/vendor-sentry-B9MY0m1g.js               309.29 kB â”‚ gzip: 102.09 kB

../public/dist/assets/index-uh5LbcbY.js                       427.09 kB â”‚ gzip: 123.90 kB

âœ“ built in 11.43s

2025-11-13T18:45:39Z info: Pushing pid1 binary layer...
2025-11-13T18:45:40Z info: Pushing Repl layer...
2025-11-13T18:45:40Z info: Pushing hosting layer...
2025-11-13T18:45:41Z info: Created hosting layer
2025-11-13T18:45:41Z info: Created pid1 binary layer
2025-11-13T18:46:25Z info: Created Repl layer
2025-11-13T18:46:28Z info: Pushed image manifest
2025-11-13T18:46:29Z info: Pushed soci index manifest
2025-11-13T18:46:36Z info: Creating Autoscale service
starting up user application
> jerky-top-n-web@1.0.0 start
metasidecar: loaded enterprise status from environment is_enterprise=false
> node server.js
forwarding local port 5000 to external port 80 (mapped as 1104)
âœ… Selected domain: jerkyrankings.replit.app
ğŸ” Environment Detection Debug:
ğŸ’¾ Dedicated worker pool created (10 connections, with auto-retry)
ğŸ”‘  Using Customer Account API for jerky.com accounts
âœ… Selected domain: jerkyrankings.replit.app
Visit the app at: http://localhost:5000
   REPLIT_DOMAINS: jerkyrankings.replit.app,rank.jerky.com
âœ… Converted to pooler URL: ep-spring-sunset-af52bwtq-pooler.c-2.us-west-2.aws.neon.tech
   REPLIT_DEPLOYMENT: 1
ğŸ¥© Jerky Top N Web server running on http://0.0.0.0:5000
âœ… Server successfully started!
ğŸ” Checking environment configuration...
   NODE_ENV: PRODUCTION
ğŸŒ  App Domain: jerkyrankings.replit.app
ğŸŒ  Production deployment detected. Available domains: jerkyrankings.replit.app, rank.jerky.com
ğŸš€ Starting Jerky Top N Web Application...
ğŸ’¾ Database connection pool configured with pooler endpoint (with auto-retry)
ğŸ“‚ Database storage connected
âœ… Sentry error monitoring initialized (PRODUCTION @ jerkyrankings.replit.app)
âœ… Database URL found
âš ï¸ recentAchievements: Using in-memory cache (single-instance only)
âœ… rankingStats: Using Redis for distributed caching
âœ… metadata: Using Redis for distributed caching
IMPORTANT! Eviction policy is optimistic-volatile. It should be "noeviction"
âœ… Rate limiters initialized for authentication endpoints
   Database: âœ… Connected
âœ… Shopify credentials found
âœ… guidance: Using Redis for distributed caching
ğŸš€ Initializing scalability features...
   Redis secrets available: [ 'UPSTASH_REDIS_URL', 'UPSTASH_REDIS_URL_PROD' ]
âœ… Scalability initialization complete
ğŸ”Œ Setting up Socket.IO Redis adapter with shared connection...

ğŸ” Redis environment: PRODUCTION
âœ… Classification queue Redis connection READY
âœ… ProgressCache initialized
ğŸ”Œ Warming up database connection...
âœ… BullMQ queue Redis connection READY
ğŸ”Œ Creating dedicated Redis connection for classification worker...
âœ… leaderboard: Using Redis for distributed caching
âœ… Redis ready for commands
âœ… JourneyCache initialized
ğŸ”Œ Creating dedicated Redis connection for classification queue...
ğŸ”Œ Warming up database connection...
ğŸ“¦ Initializing distributed caches...
ğŸŒ  Production deployment detected. Available domains: jerkyrankings.replit.app, rank.jerky.com
ğŸª  Shop Domain: jerky-com.myshopify.com
ğŸ”Œ Creating dedicated Redis connection for BullMQ queue...
âœ… Database is query-ready (1 attempt, 320ms)
âœ… LeaderboardCache initialized
   Shopify Integration: âœ… Available
âœ… Socket.IO using Redis adapter for cross-instance communication
ğŸ“Š Service Status:
ğŸ”Œ Establishing Redis connection pool...
âœ… leaderboardPosition: Using Redis for distributed caching
âœ… user_classification: Using Redis for distributed caching
âœ… homeStats: Using Redis for distributed caching
ğŸ’¾ Redis: Using existing connection (connection pool)
ğŸ® Initializing gamification system...
âœ… journey: Using Redis for distributed caching
âœ… Community routes registered at /api/community
âœ… Database is query-ready (1 attempt, 214ms)
ğŸ’¾ Primary database connection configured (no pooler - read from primary)
âœ… Rate limiters configured using memory (single-instance)
âœ… Profile routes registered at /api/profile
âœ… progress: Using Redis for distributed caching
ğŸš€ Initializing distributed cache service...
âœ… Classification queue initialized with hardened Redis connection
âœ… Classification worker Redis connection READY
âœ… Database instances warmed and ready for queries
âœ… achievement: Using Redis for distributed caching
âœ… achievement: Using Redis for distributed caching
ğŸ” Redis environment: PRODUCTION
âœ… leaderboard: Using Redis for distributed caching
âœ… Bulk import queue initialized with hardened Redis connection
âœ… products: Using Redis for distributed caching
âœ… All caches using Redis for distributed caching
âœ… Redis connection pool established
ğŸ·ï¸  WebSocket environment prefix: prod
ğŸ”§ Shopify Customer Authentication Configuration:
â„¹ï¸  Waiting 3000ms for networking to stabilize before schema validation...
IMPORTANT! Eviction policy is optimistic-volatile. It should be "noeviction"
ğŸ”Œ Database client connected to pool { totalConnections: 1, idleConnections: 0, waitingRequests: 0 }

âœ… Health check routes registered at /api/health
ğŸ’¾ Redis: Using existing connection (connection pool)
âœ… Gamification routes registered at /api/gamification
âœ… AchievementCache initialized
ğŸ”Œ Establishing Redis connection pool...
âœ… UserProfileCache initialized
âœ… GuidanceCache initialized
âœ… StreakCache initialized
âœ… Email service initialized: no-reply@jerky.com via smtp.gmail.com:587
ğŸ“ Redis PING successful - connection pool active
âœ… UserClassificationCache initialized
âœ… All distributed caches initialized
âœ… user_profile: Using Redis for distributed caching
ğŸ” Using Redis variable: UPSTASH_REDIS_URL_PROD
âœ… Redis connection pool established
âœ… Flavor profile communities routes registered at /api/flavor-profile-communities
âœ… Redis ready for commands
ğŸ” Using Redis variable: UPSTASH_REDIS_URL_PROD
ğŸ“ Redis PING successful - connection pool active
âœ… streak: Using Redis for distributed caching
âœ… WebSocket gateway initialized
âœ… Classification worker initialized with resilient error handling (concurrency: 5)
2025-11-13T18:47:25Z info: Waiting for service to be ready
IMPORTANT! Eviction policy is optimistic-volatile. It should be "noeviction"
ğŸ” Validating database schema against Drizzle definitions...
IMPORTANT! Eviction policy is optimistic-volatile. It should be "noeviction"
âœ… BulkImportService initialized with WebSocket gateway and classification queue
ğŸ”Œ Creating dedicated Redis connection for BullMQ worker...
ğŸ’¾ Redis: Using existing connection (connection pool)
2025-11-13T18:47:27Z info: Deployment successful